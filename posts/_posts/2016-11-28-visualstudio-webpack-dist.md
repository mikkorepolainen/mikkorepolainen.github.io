---
layout: post
title: Fixing webpack vendor build in .NET Core web app template
relativeroot: ../../../../
category: posts
alt_excerpt: Cannot find module './wwwroot/dist/vendor-manifest.json' after checkout from version control?
---

I'm currently working on a .NET Core / React web application using a template, which worked great so far.
However, after getting a fresh checkout, I started experiencing the error `Cannot find module './wwwroot/dist/vendor-manifest.json'` when starting up on top of IIS Express.

Turns out that this is because, by default, the `wwwroot/dist` directory is excluded from version control while the build process depends on the `vendor-manifest.json` file therein.
However, the dist directory does not get regenerated on build for some reason.
Perhaps the prepublish step `node node_modules/webpack/bin/webpack.js --config webpack.config.vendor.js --env.prod` is not always executed, even though the `main.js` and `main.js.map` files are updated by build/debug?

The dist directory does get regenerated by running either `webpack --config webpack.config.vendor.js` or `dotnet publish` before debugging.
I just copied the prepublish step as a new precompile step in `project.json` to prevent further head scratching:

{% highlight json %}
{
  ...,
  "scripts": {
    "precompile": [
      "node node_modules/webpack/bin/webpack.js --config webpack.config.vendor.js --env.prod"
    ],
    "prepublish": [
      "npm install",
      "node node_modules/webpack/bin/webpack.js --config webpack.config.vendor.js --env.prod",
      "node node_modules/webpack/bin/webpack.js --env.prod"
    ],
    "postpublish": [ "dotnet publish-iis --publish-folder %publish:OutputPath% --framework %publish:FullTargetFramework%" ]
  },
  ...
}
{% endhighlight %}

References:

- <https://github.com/aspnet/JavaScriptServices/issues/99>
- <https://github.com/aspnet/JavaScriptServices/issues/312>
