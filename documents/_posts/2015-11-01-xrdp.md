---
layout: document
title: Using xRDP for Remote Desktop Access
description: Enabling Remote Desktop Protocol connectivity using xRDP on Ubuntu 14.04 LTS and the xfce window manager.
modified: 2015-11-01 23:59:00
relativeroot: ../../
permalink: documents/xrdp
type: document
tags:
- xRDP
- Remote Desktop
- Linux
category: documents
content-links:
- <a href="#wm">Window Manager</a>
- <a href="#xrdp">xRDP Server</a>
- <a href="#kb">Keyboard Mappings</a>
- <a href="#xterm">XTerm Autocomplete</a>
- <a href="#bell">Disable PC Speaker</a>
- <a href="#references">References & Resources</a>
published: true
---
{{ page.title }}
====================

This document contains the steps for enabling remote desktop access to a linux server using the Remote Desktop Protocol.
The server operating system used here is Ubuntu Server 14.04 LTS.

<a name="wm"></a>Window Manager
--------------

Xfce is used for RDP sessions because gnome [does not work well][How to use xRDP for remote access to Ubuntu 14.04] with RDP on Ubuntu 14.04.

**Installing Xfce Manually**

If you have an existing system without xfce, run `apt-get install xfce4`.
Then, modify `/etc/xrdp/startwm.sh` to start xfce4 session instead:

{% highlight bash %}
#!/bin/sh  

if [ -r /etc/default/locale ]; then
  . /etc/default/locale
  export LANG LANGUAGE
fi

startxfce4
{% endhighlight %}

To configure the xfce4 session only for the current user, add `xfce4-session` to the file `~/.xsession` (create the file if it does not exist).

<a name="xrdp"></a>xRDP Server
----------------------

Install xrdp:

{% highlight bash %}
apt-get install xrdp
{% endhighlight %}

Connect using a remote desktop client (Module sesman-Xvnc).

<a name="kb"></a>Keyboard Mappings
-----------------------

Xrdp does not pick up the correct key map by default from the server if the xrdp layout file is not present on the system (for example finnish).

For finnish keyboard layout the easiest way is to [copy][xRDP with finnish keyboard] the swedish keyboard layout as the finnish layout:  
`cp /etc/xrdp/km-041d.ini /etc/xrdp/km-040b.ini`.

Layout ini files can also be [generated][xRDP keyboard layout] if you manage to get the correct layout working manually first.
You can try running `setxkbmap -layout fi` while logged on to the server locally (over xRDP you get the error XKB extension not present on :XX.X)
When the layout is correct in the current session, run `xrdp-genkeymap /etc/xrdp/km-040b.ini`.
The correct code for the file name (040b for finnish) can be found for example on [this][rdesktop keymap names] page.

After the correct layout file is added, logging out and back in with remote desktop should give the correct default key mappings automatically.

<a name="xterm"></a>XTerm Autocomplete
--------------------------

If tab autocomplete doesn't work in xterm in an xfce session over xrdp, then edit the following file:  
`~/.config/xfce4/xfconf/xfce-perchannel-xml/xfce4-keyboard-shortcuts.xml`.

Change  
`<property name="&lt;Super&gt;Tab" type="string" value="switch_window_key"/>`  
to  
`<property name="&lt;Super&gt;Tab" type="empty"/>`

<a name="bell"></a>Disable PC Speaker
---------

By default the pc speaker is enabled, including error sounds from xterm (e.g. too many backspaces or no direct match from tab autocomplete).
This can be really annoying because in an RDP session the beep seems to block all input and takes a long time to complete.

One solution is to disable the pc speaker: run `xset -b` after login or add the command to `~/.bashrc` (create the file if it does not exist).

<a name="references"></a>References & Resources
---------

- [How to use xRDP for remote access to Ubuntu 14.04]
- [xRDP with finnish keyboard]
- [xRDP keyboard layout]
- [rdesktop keymap names]

[How to use xRDP for remote access to Ubuntu 14.04]: http://www.tweaking4all.com/software/linux-software/use-xrdp-remote-access-ubuntu-14-04/
[xRDP with finnish keyboard]: http://askubuntu.com/questions/290453/xrdp-with-finnish-keyboard
[xRDP keyboard layout]: https://bernatarlandis.wordpress.com/2013/08/09/wrong-keyboard-layout-in-rdp-session-over-debian-gnulinux/
[rdesktop keymap names]: https://github.com/eby/rdesktop/blob/master/doc/keymap-names.txt
