---
layout: document
title: Docker Notes 
description: General docker notes. This document will eventually evolve and branch out to multiple documents.
modified: 2016-05-01 23:59:00
relativeroot: ../../
permalink: documents/docker
type: document
tags:
- Docker
- KVM
- Containers
category: documents
published: true
hidden: true
---

Installing Docker
===========

Linux
------

Quick install: `curl -sSL https://get.docker.com/ | sh`

Add user to docker group for use without sudo:

- `sudo usermod -aG docker <user>`
- Restart the docker service (e.g. `sudo service docker restart` on Ubuntu)
- Log out and back in again.

Removing:

{% highlight bash %}
apt-get purge docker-engine
apt-get autoremove --purge docker-engine
rm -rf /var/lib/docker
{% endhighlight %}

Note that the last command removes also all volumes and configuration data from containers.

Windows & Mac OS
----------------------

Download and install [docker toolbox](https://www.docker.com/products/docker-toolbox).
The toolbox contains the docker tools and can be used to run docker containers on top of Oracle VirtualBox.
The installer contains an option for installing VirtualBox in case it's not already installed.

Running kitematic (docker UI) spins up a new local VM called `default` on top of VirtualBox. TODO or was it created on install?
You can also control the VMs using the `docker-machine` command line tool. See more in section [Docker Machine](#Docker_Machine).

Managing Docker hosts
====================

Docker Machine
-----------------------

Docker Machine can be used to create virtual machines for use as docker hosts.
The operating system on the virtual machines is installed by default from the latest boot2docker.iso from [github](https://github.com/boot2docker/boot2docker/releases/).
TODO Suitability for production use?

### Installation

On linux, the docker-machine binary is a separate install (the docker toolbox contains docker-machine by default).
Check the latest version in https://github.com/docker/machine/releases and follow the instructions, e.g.:

{% highlight bash %}
curl -L https://github.com/docker/machine/releases/download/v0.7.0/docker-machine-`uname -s`-`uname -m` >/usr/local/bin/docker-machine
chmod +x /usr/local/bin/docker-machine
{% endhighlight %}

### Creating a local VM on VirtualBox

`sudo docker-machine create --driver virtualbox <VM Name>`

TODO bridged networking

### Creating a local VM on KVM

Using docker-machine with KVM requires a third party driver, e.g.: [docker-machine-kvm](https://github.com/dhiltgen/docker-machine-kvm).
(For setting up a KVM environment, see [Virtualization With KVM]({% post_url 2015-10-07-virtualization-with-kvm %}).)

{% highlight bash %}
apt-get install libvirt-go
curl -L https://github.com/dhiltgen/docker-machine-kvm/releases/download/v0.6.0/docker-machine-driver-kvm > /usr/local/bin/docker-machine-driver-kvm
chmod +x /usr/local/bin/docker-machine-driver-kvm
{% endhighlight %}

Creating a VM: `docker-machine create --driver kvm --kvm-cpu-count 1 --kvm-disk-size 20000 --kvm-memory 1024 <VM name>`

To expose the VM to the surrounding network by connecting the VM to an existing host bridge, add `--kvm-network <network name>` to the above command, where `network name` is the name of a host bridge added as a virtual network or reconfigure networking after creating the VM.
See [Virtualization With KVM]({% post_url 2015-10-07-virtualization-with-kvm %}#Bridged_Networking_Create_a_Virtual_Network_Using_the_Existing_Bridge).

NOTE: The host name of the VM seems to be `boot2docker` when first created, bridged to a network that uses DHCP for DNS.
Rebooting the VM seems to rectify the issue.

### Removing a VM

`docker-machine rm <VM name>`

### Interacting With the VM

Docker Quickstart Terminal is set up automatically with required environment variables pointing to the default docker VM.
On another terminal, you need to do `eval $(docker-machine env default)` to set up the environment.

To find out the "public" ip address of the VM, use `docker-machine ssh <VM name> "ip -one -4 addr show dev eth0|cut -f7 -d' '"`

### Commands

- `docker-machine ls` list VMs created using docker-machine on the current host
- `docker-machine ip <VM Name>` get ip address of VM
- `docker-machine ssh <VM Name>` ssh access
- `docker-machine inspect <VM Name>` machine information
- `docker-machine start <VM Name>` start
- `docker-machine stop <VM Name>` stop
- `docker-machine restart <VM Name>` restart
- `docker-machine kill <VM Name>` kill
- `docker-machine rm <VM Name>` remove

See more information in [docker-machine reference](https://docs.docker.com/machine/reference/).
